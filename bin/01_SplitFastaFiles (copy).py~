'''This will take the aligned multiple FASTA file with multiple genes 
    and create individual FASTA alignment files for each gene.'''

from sys import argv
from Bio import AlignIO

def splitFasta(infile, path, n):
    # Open input file and split into one alignment per gene
    with open(infile, "r") as fasta:
        try:
            alignment = AlignIO.parse(fasta, "fasta")
            for i in alignment:
                name = i[0].id.split(".")
                '''Generate output file name and write single-gene alignment to
                file. Include n in filename to record number of sequences per
                file'''
                outfile = (path + "01_splitFastaFiles/" + name[1].rstrip() + "."
                           + str(n) + ".fa")
                AlignIO.write(i,outfile,"fasta")
        except ValueError:
            '''Attempt to run with progressively fewer sequences until the
number of sequences present in the segment is found. Does not print files
with only one sequence.'''
            if n > 2:
                splitFasta(infile, path, n-1)
            else:
                pass

def main():
    if argv[1] == "-h" or argv[1] == "--help":
        print("Usage: python 01_splitFastaFiles.py <# of species in alignment> \
<input fasta alignment> <path to output directory>")
        quit()
    else:
        # Set input file name
        n = int(argv[1])
        infile = argv[2]
        path = argv[3]
        splitFasta(infile, path, n)

if __name__ == "__main__":
    main()
